\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

% modify the default page geometry
\usepackage[left=1.7in,right=1.5in,top=2cm,bottom=2cm,includefoot,includehead,headheight=13.6pt]{geometry}
%\usepackage[bottom=1cm,top=1cm, includefoot,includehead, headheight=5pt, paperwidth=6in, paperheight=9in]{geometry}

% =============================================================================
\usepackage{algorithm}
\usepackage{alltt} % math support in verbatim text
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bold-extra} % bold support for small caps 
\usepackage[hypcap]{caption} % with hyperref point to the head of the pic
\usepackage{caption}
\usepackage{chngpage} % allows for temporary adjustment of side margins
\usepackage{cite}
\usepackage{color} % custom colors for text
\usepackage{enumerate} % enable enumerated lists
\usepackage[shortlabels]{enumitem} % enables [noitemsep,nolistsep] for more compact lists and various flavours of enum labels
\usepackage{booktabs} % used for \midrule
\usepackage{fancyhdr} % Fancy Header and Footer
\usepackage{float}      % for the strong here [H] of figures
\usepackage{graphicx} % extended arguments for \in­clude­graph­ics
\usepackage[htt]{hyphenat} % enable hyphenation of \textt + custom hypenation rules for words
% \usepackage{hyperref} see at the end of the header.tex
\usepackage{ifthen} % support boolean "branches" => enables conditional macros
\usepackage{tgtermes} % tex gyre thermes font
\usepackage{multirow} % fancy stuff for tables: multirow, bigdelim, bigstrut
\usepackage{rotating} % Sideways of figures & tables
\usepackage{slantsc} % http://ctan.org/pkg/slantsc enable fake italic small caps in fonts that do not have native support for this
\usepackage{stmaryrd} % St Mary Road symbols for theoretical computer science
\usepackage{subcaption}
\usepackage{url}    % add url/link support  
\usepackage{wrapfig} % suppport for figures with text wrapped around 
\usepackage{xspace}
\usepackage[normalem]{ulem} % for \sout
\usepackage[table,svgnames]{xcolor}
\usepackage{tabularx}
\usepackage{tablefootnote}
\usepackage{pifont} %  Access to PostScript standard Symbol and Dingbats fonts

% Font choices (I need real smallcaps!)
%\usepackage{libertine}
%\usepackage[osf]{mathpazo} % palatino with real small caps and oldstyle numbers
\usepackage{tgpagella} % Use TeX Gyre Pagella with real small caps (normal + bold)
\usepackage{tgcursor} % fixed wifth font TeX Gyre Cursor (Courrier Style)

% =============================================================================
% enable decimal columns in tables
\usepackage{dcolumn}
% define a new columntype "d" for decimal aligned numbers which takes as argument
% the number of decimal places to be displayed
\newcolumntype{d}[1]{D{.}{.}{#1} }

%the argument for d specifies the maximum number of decimal places
%\begin{tabular}{l r c d{1} }
%Left&Right&Center&\mathrm{Decimal}\\
%1&2&3&4\\
%11&22&33&44\\
%1.1&2.2&3.3&4.4\\
%\end{tabular}
% =============================================================================
% support proper SI units in latex: for instance \num{0.235+-0.005} is properly formatted as 0.235(5)
\usepackage{siunitx} 
% setup the si units package globally
\sisetup{
	separate-uncertainty = true % show the +/- for uncertainty, computer scienticts have no clue about the 0.2352(66) notion
}


% =============================================================================
 % environment hooks and patching:
\usepackage{etoolbox}

% Helper command for reducing spaces after certain environment (see below...)
\makeatletter
% uncomment the following if you don't want \clubpenalty\@M ...
% \let\nearly@afterheading\@afterheading
% \patchcmd\nearly@afterheading
%   {\@M}% original temporary setting for \clubpenalty replaced by ...
%   {\@clubpenalty}% ... or whichever value you deem right
%   {}{}
% ... and use \nearly@afterheading instead of \@afterheading here:
\newcommand*\NoIndentAfterEnv[1]{%
  \AfterEndEnvironment{#1}{\par\@afterindentfalse\@afterheading}}
\makeatother

% Disable indentation after a certain environment: \NoIndentAfterEnv{itemize}
% note that this might break the space for the paragraph follwing such a modified one
%\NoIndentAfterEnv{itemize}
%\NoIndentAfterEnv{enumerate}
%\NoIndentAfterEnv{description}
%\NoIndentAfterEnv{table}
%\NoIndentAfterEnv{figure}

%\renewcommand*\arraystretch{1.2} % modify the line spacing in tables

% globally reduce the space between list items
\newlength{\wideitemsep}
\setlength{\wideitemsep}{.5\itemsep}
\addtolength{\wideitemsep}{-3pt}
\let\olditem\item
\renewcommand{\item}{\setlength{\itemsep}{\wideitemsep}\olditem}


% =============================================================================
% Settings to add a small (mini) Table of contents at the beginning of each chapter
\usepackage[nottoc, notlof, notlot]{tocbibind}
\usepackage[tight]{minitoc} % tight=single line spacing
\setcounter{minitocdepth}{1}
% change the minitoc fonts
\renewcommand{\mtcfont}{\small\normalfont} 
\renewcommand{\mtcSfont}{\mtcfont} 
\renewcommand{\mtifont}{\Large\bf} % use the same font as for the section font for the title of the contents
\nomtcrule % no visual minitoc rule
\mtcindent=2pt % indent just enough to make it visually look aligned

\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{2}
  
% =============================================================================
% Fancy Header Style Options

\pagestyle{fancy}                       % Sets fancy header and footer
\fancyfoot{}                            % Delete current footer settings

%\renewcommand{\chaptermark}[1]{         % Lower Case Chapter marker style
%  \markboth{\chaptername\ \thechapter.\ #1}}{}} %

%\renewcommand{\sectionmark}[1]{         % Lower case Section marker style
%  \markright{\thesection.\ #1}}         %

\fancyhead[LE,RO]{\thepage}					% Page number (boldface) on the left on even
											% pages and on the right on odd pages
\fancyhead[RE]{\nouppercase{\leftmark}}		% Chapter on the right on even pages
\fancyhead[LO]{\nouppercase{\rightmark}}	% Section on the left on odd pages

\let\headruleORIG\headrule
\renewcommand{\headrule}{\color{black} \headruleORIG}
\renewcommand{\headrulewidth}{0pt}
\usepackage{colortbl}
\arrayrulecolor{black}

\fancypagestyle{plain}{
  \fancyhead{}
  \fancyfoot{}
  \renewcommand{\headrulewidth}{0pt}
}

% Clear Header Style on the Last Empty Odd pages
\makeatletter

\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else%
  \hbox{}%
  \thispagestyle{empty}%              % Empty header styles
  \newpage%
  \if@twocolumn\hbox{}\newpage\fi\fi\fi}

\makeatother

% centered page environment
\newenvironment{vcenterpage}
	{\newpage\vspace*{\fill}\thispagestyle{empty}\renewcommand{\headrulewidth}{0pt}}
	{\vspace*{\fill}}
	
% automatically insert a period at the end of a paragraph title.
\let\originalparagraph\paragraph
\renewcommand{\paragraph}[2][.]{\originalparagraph{#2#1\!\!\!\!}}

% enable french spacing: 1 space after a dot instead of the 2 in english
\frenchspacing

%=============================================================================
\usepackage{needspace}
% \needlines{3} ensures that the following 3 lines will be on the same page
% typically used in code examples where arbitrary broken up parts are hard to read
\newcommand{\needlines}[1]{\Needspace{#1\baselineskip}}

\definecolor{source}{gray}{0.95}
\definecolor{light-gray}{rgb}{0.8,0.8,0.8}
\definecolor{comment}{rgb}{0.35,0.35,0.35}
\definecolor{string}{rgb}{0.5,0,0.5}
\definecolor{darkRed}{rgb}{0.5,0,0}
\definecolor{darkBlue}{rgb}{0,0,0.3}
\definecolor{darkCyan}{rgb}{0,0.3,0.3}

% source code formatting
\usepackage{listings}
% global settings for source code listing package
\lstset{
    basicstyle=\ttfamily,
    showspaces=false,
    showstringspaces=false,
    lineskip=-0.1pt,
    stepnumber=2,
    numberfirstline=true,
    captionpos=b,
    emphstyle=\bf\ttfamily,
    columns=fullflexible}

% define Smalltalk like grammar for the listing package
\lstdefinelanguage{ST}{
    keywordsprefix=\#,
    morekeywords=[0]{true,false,nil},
    morekeywords=[1]{self,super,thisContext},
    morekeywords=[2]{ifTrue:,ifFalse:,whileTrue:,whileFalse:,and:,or:,xor:,not:,by:,timesRepeat:},
	morekeywords=[3]{Benzo,FFI},
    sensitive=true,
    morecomment=[s]{"}{"},
    morestring=[d]',
    escapechar={!},
    alsoletter={., :, -, =, +, <},
    moredelim=**[is][\itshape]{/+}{+/},
    literate=
        {^}{{$\uparrow$}}1
        {:=}{{$\leftarrow$}}1
        {~}{{$\sim$}}1
        {-}{{\sf -\hspace{-0.13em}-}}1  % the goal is to make - the same width as +
        {+}{\raisebox{0.08ex}{+}}1		% and to raise + off the baseline to match V
        , % Don't forget the comma at the end!
    style=STStyle
}
\lstdefinestyle{STStyle}{
    tabsize=4,
    %frame=leftline,
    %frame=bl,
    %framerule=2pt,
    %rulecolor=\color{gray},
    %backgroundcolor=\color{white},
    %backgroundcolor=\usebeamercolor[bg]{listing},
    basicstyle=\ttfamily,
    keywordstyle=\bfseries\ttfamily,
    %stringstyle=\color{orange},
    stringstyle=\mdseries\slshape,
    %commentstyle=\it\rmfamily\color{darkgray}, 
    commentstyle=\mdseries\slshape\color{darkgray},
    %commentstyle=\mdseries\slshape,
    emphstyle=\bf\ttfamily,
    escapeinside={!}{!},
	%backgroundcolor=\color{source},
    %emphstyle={[2]\color{red}},
    %emphstyle={[3]\color{blue}\bf},
    %emphstyle={[4]\color{blue}},
    keepspaces=true
} 

%\lstnewenvironment{javacode}  [1][]{\lstset{language=java,#1}\needlines{#2}}{} 
%\lstnewenvironment{pythoncode}[2][]{\lstset{language=python,#1}\needlines{#2}}{}
\lstnewenvironment{stcode}    [2][]{\lstset{language=ST,#1}\needlines{#2}}{}
\lstnewenvironment{ccode}     [2][]
    {\lstset{language=C,numbers=left,escapechar=\$,numberstyle=\tiny,#1}\needlines{#2}}{}

% code environment with line numbers and support for \needlines which keeps a
% given number of lines of the code together (see needline comment above)
\lstnewenvironment{numstcode} [2][]
    {\lstset{language=ST,numbers=left,numberstyle=\tiny,numbersep=5pt,#1}\needlines{#2}}{}
\lstnewenvironment{numstcodecont} [2][]
    {\lstset{language=ST,numbers=left,numberstyle=\tiny,numbersep=5pt,firstnumber=last#1}\needlines{#2}}{}

\newcommand{\lst}[1]{{\tt #1}}

% Use this only in special situations where \ct does not work
% (within Section headings ...):
\newcommand{\lct}[1]{{\textsf{\textup{#1}}}}
% Code environments
\lstnewenvironment{code}{%
	\lstset{%
		% frame=lines,
		frame=single,
		framerule=0pt,
		mathescape=false
	}
}{}

\renewcommand{\lstlistingname}{Code Example}

% =============================================================================
% support for annotations direclty in the latex sources
\newboolean{showcomments}
% create a boolean to enable/disable comments (use \setboolean{showcomments}{false} 
% for instance in the main file)
\setboolean{showcomments}{true}
\newcommand\ifshowcomment[2]{\ifthenelse{\boolean{showcomments}}{#1}{#2}}
% used to deal with the spaces inserted by hidden comments
\newcommand\commentbackspace{\!\!\!} %\!\!\!\!\!

% please rephrase
\newcommand\ugh[1]{
	\ifshowcomment
		{\textcolor{red}{\uwave{#1}}}
		{#1}}
% please insert
\newcommand\ins[1]{
	\ifshowcomment
		{\textcolor{blue}{\uline{#1}}}
		{#1}}
% please delete							
\newcommand\del[1]{
	\ifshowcomment
		{\textcolor{red}{\sout{#1}}}
		{\commentbackspace}}
% please change
\newcommand\chg[2]{ %
	\ifshowcomment
		{\textcolor{red}{\sout{#1}}{\ra} %
		\textcolor{blue}{\uline{#2}}} %
		{\commentbackspace}}
% comment with color
\newcommand\nbc[3]{ %
	\ifshowcomment{ %
		{\colorbox{#3}{\bfseries\sffamily\scriptsize\textcolor{white}{#1}}}{\color{#3}
			\sf\small$\blacktriangleright$
			{\itshape #2}
			$\blacktriangleleft$}}
		{\commentbackspace}}



\newcommand\nb[2]  {\nbc{#1}{#2}{orange}}
\newcommand\fix[1] {\nb{FIX}{#1}}
\newcommand\todo[1]{\nb{TO DO}{#1}}

% shortcuts for comments by reviewers
\newcommand\cb[1]{\nbc{CB}{#1}{purple}} % camillo bruni
\newcommand\sd[1]{\nbc{SD}{#1}{orange}} % stephane ducasse
\newcommand\is[1]{\nbc{IS}{#1}{gray}}   % igor stasenko
\newcommand\sm[1]{\nbc{SM}{#1}{olive}}  % stefan marr
\newcommand\ct[1]{\nbc{CT}{#1}{teal}}   % camille tereul
\newcommand\md[1]{\nbc{MD}{#1}{blue}}   % marcus denker
\newcommand\dc[1]{\nbc{DC}{#1}{green}}  % damien cassou
\newcommand\lt[1]{\nbc{LT}{#1}{green}}  % laurence tratt
\newcommand\cd[1]{\nbc{CD}{#1}{teal}}   % christophe dony
\newcommand\gt[1]{\nbc{GT}{#1}{blue}}   % gael thomas

% =============================================================================
\usepackage[pagebackref,hyperindex=true]{hyperref}

% Links in pdf should be black
\definecolor{linkcol}{rgb}{0.0, 0.0, 0.0} 
\definecolor{citecol}{rgb}{0.0, 0.0, 0.0} 

% Change this to change the informations included in the pdf file
% See hyperref documentation for information on those parameters
\hypersetup {
	bookmarksopen=true,
	pdftitle=\thesistitle,
	pdfauthor=\thesisauthor, 
	pdfsubject="", %subject of the document
	pdfhighlight=/O, %effect of clicking on a link
	colorlinks=false,
	pdfpagemode=UseNone,
	pdfpagelayout=SinglePage,
	pdffitwindow=true,
	linkcolor=linkcol,
	citecolor=citecol,
	urlcolor=linkcol
}

% =============================================================================
% Reference macros for common elements
% use \figlabel{myKey} instead of \label{fig:myKey} and the according \figref below
\newcommand{\figlabel}[1] {\label{fig:#1}}
\newcommand{\chaplabel}[1]{\label{chap:#1}}
\newcommand{\seclabel}[1] {\label{sec:#1}}
\newcommand{\tablabel}[1] {\label{tab:#1}}
\newcommand{\lstlabel}[1] {\label{lst:#1}}

\newcommand{\figref}[1] {\hyperref[fig:#1]{Figure}~\ref{fig:#1}}
\newcommand{\chapref}[1]{\hyperref[chap:#1]{Chapter}~\ref{chap:#1}}
\newcommand{\secref}[1] {\hyperref[sec:#1]{Section}~\ref{sec:#1}}
\newcommand{\tabref}[1] {\hyperref[tab:#1]{Table}~\ref{tab:#1}}
\newcommand{\lstref}[1] {\hyperref[lst:#1]{Listing}~\ref{lst:#1}}

% Macro for adding at the same time a link to the final pdf and add a footnote with 
% the url useful for printed versions: \urlfootnote{Google}{http://google.com/}
\newcommand{\urlfootnote}[2] {\href{#2}{#1}\footnote{\url{#2}}}

\newcommand{\commented}[1]{}

% custom Introduction section, slightly pushed left to visually align with the following paragraph
\newcommand{\introduction}{\section*{\hspace{-1pt}Introduction}} 

\newcommand{\bs}    {\symbol{'134}} % backslash
\newcommand{\us}    {\symbol{'137}} % underscore
\newcommand{\ttt}[1]{\texttt{#1}}
\newcommand{\ie}    {\emph{i.e.},\xspace}
\newcommand{\eg}    {\emph{e.g.},\xspace}
\newcommand{\etal}  {\emph{et al.}\xspace}
\newcommand{\ns}    {\!\!\!\!} %big negative space
\newcommand{\cnull} {\textbackslash0\xspace}
\renewcommand{\epsilon}{\varepsilon}


% italic quotes
%\let\oldquote\quote
%\let\oldendquote\endquote
%\renewenvironment{quote}
%	{\oldquote\itshape}
%	{\oldendquote}
	
% =============================================================================
% Add custom hypenation rules for difficult words here:
\hyphenation{tool-chain pipe-line lan-guage lan-guage-side ge-ne-ric bind-ing bind-ings pri-mi-tive pri-mi-tives Na-tive-Bo-ost}

% the following settings limit a bit the warnings latex spits out to focus on the
% really bad ones

% allow lines to stretch spaces to cope with lines that cannot be filled properly 
\setlength{\emergencystretch}{2em}
% only report underfull hbox above this badness level
\hbadness=2000
% only report overfull hbox above this badness level
\hfuzz=1pt

% =============================================================================
% by default I use 10pt for text in all figures, hence depending on the default
% font size of the latex document you can adjust the scaling globally here if
% you use \includegraphics[scale=\imagescale]{myFigureName} for figures
% this is useful if you later change the fontsize of the document
\newcommand\imagescale{1.1}

% =============================================================================
% Add macros for common names here, Use smallcaps (\textsc) for product names
\newcommand{\CogMethod}{\texttt{CogMethod}\xspace}

\newcommand{\API}	{\textsc{api}\xspace}
\newcommand{\ARM}	{\textsc{arm}\xspace}
\newcommand{\AST}	{\textsc{ast}\xspace}
\newcommand{\ASM}	{\textsc{asm}\xspace}
\newcommand{\AsmJIT}{\textsc{Asm\-Jit}\xspace}
\newcommand{\AsmJit}{\textsc{Asm\-Jit}\xspace}
\newcommand{\Alien}	{\textsc{Al\-ien}\xspace}
\newcommand{\B}		{\textsc{Ben\-zo}\xspace}
\newcommand{\Bochs}	{\textsc{Bochs}\xspace}
\newcommand{\CPU}	{\textsc{cpu}\xspace}
\newcommand{\CPUs}	{\textsc{cpu}s\xspace}
\newcommand{\Cog}	{\textsc{Cog}\xspace}
\newcommand{\DSL}	{\textsc{DSL}\xspace}
\newcommand{\DTrace}	{\textsc{DTrace}\xspace}
\newcommand{\Dwarf}	{\textsc{Dwarf}\xspace}
\newcommand{\DwarfPython}	{\textsc{DwarfPython}\xspace}
\newcommand{\ELF}	{\textsc{elf}\xspace}
\newcommand{\FFIs}	{\textsc{ffi}s\xspace}
\newcommand{\FFI}	{\textsc{ffi}\xspace}
\newcommand{\Eye}	{\textsc{Eye}\xspace}
\newcommand{\Gepetto}	{\textsc{Gepetto}\xspace}
\newcommand{\GC}	{\textsc{gc}\xspace}
\newcommand{\GCC}	{\textsc{gcc}\xspace}
\newcommand{\GDB}	{\textsc{gdb}\xspace}
\newcommand{\Graal}	{\textsc{Graal}\xspace}
\newcommand{\IDE}	{\textsc{ide}\xspace}
\newcommand{\IDEs}	{\textsc{ide}s\xspace}
\newcommand{\INRIA}	{\textsc{inria}\xspace}
\newcommand{\IR}	{\textsc{ir}\xspace}
\newcommand{\JIT}	{\textsc{jit}\xspace}
\newcommand{\Java}	{\textsc{Ja\-va}\xspace}
\newcommand{\Jikes}	{\textsc{Ji\-kes}\xspace}
\newcommand{\Klein}	{\textsc{Klein}\xspace}
\newcommand{\Linux}	{\textsc{Li\-nux}\xspace}
\newcommand{\LLDB}	{\textsc{lldb}\xspace}
\newcommand{\LuaJIT}{\Luajit}
\newcommand{\Luajit}{\textsc{Lua\-jit}\xspace}
\newcommand{\Lua}	{\textsc{Lua}\xspace}
\newcommand{\Mate}	{\textsc{Ma\-te}\xspace}
\newcommand{\MachO}	{\textsc{Mach-O}\xspace}
\newcommand{\Maxine}{\textsc{Maxine}\xspace}
\newcommand{\MIST}	{\textsc{MIST}\xspace}
\newcommand{\MMTK}	{\textsc{mmtk}\xspace}
\newcommand{\MV}	{\textsc{mv}\xspace}
\newcommand{\MVs}	{\textsc{mv}s\xspace}
\newcommand{\MOP}	{\textsc{mop}\xspace}
\newcommand{\NBFFI}	{\textsc{Na\-tive\-Bo\-ost-ffi}\xspace}
\newcommand{\NBJ}	{\textsc{Nabu\-jito}\xspace}
\newcommand{\NB}	{\textsc{Na\-tive\-Bo\-ost}\xspace}
\newcommand{\Nabujito}	{\NBJ\xspace}
\newcommand{\OS}	{\textsc{os}\xspace}
\newcommand{\OSX}	{\textsc{OS X}\xspace}
\newcommand{\Parathon}	{\textsc{Parathon}\xspace}
\newcommand{\PH}	{\textsc{Pharo}\xspace}
\newcommand{\Pinocchio}		{\textsc{Pi\-noc\-chio}\xspace}
\newcommand{\ptrace}		{\textsc{ptrace}\xspace}
\renewcommand{\P}	{\Pinocchio}
\newcommand{\PyPy}	{\textsc{Py\-Py}\xspace}
\newcommand{\Python}{\textsc{Py\-thon}\xspace}
\newcommand{\Quicktalk}{\textsc{Quick\-talk}\xspace}
\newcommand{\RMoD}	{\textsc{rmod}\xspace}
\newcommand{\RPython}{\textsc{RPy\-thon}\xspace}
\newcommand{\Ruby}{\textsc{Ruby}\xspace}
\newcommand{\SCG}	{\textsc{scg}\xspace}
\newcommand{\Sista}	{\textsc{Sista}\xspace}
\newcommand{\SSA}	{\textsc{ssa}\xspace}
\newcommand{\ST}	{\textsc{Small\-talk}\xspace}
\newcommand{\Self}	{\textsc{Self}\xspace}
\newcommand{\Slang} {\textsc{Slang}\xspace}
\newcommand{\Squeak} {\textsc{Squeak}\xspace}
\newcommand{\TAC}	{\textsc{tac}\xspace}
\newcommand{\UBA}	{\textsc{uba}\xspace}
\newcommand{\unix}	{\textsc{unix}\xspace}
\newcommand{\VCPU}	{\textsc{Vir\-tual\-Cpu}\xspace}
\newcommand{\VirtualCPU}	{\VCPU}
\newcommand{\Windows}	{\textsc{Win\-dows}\xspace}
\newcommand{\VMs}	{\textsc{vm}s\xspace}
\newcommand{\VM}	{\textsc{vm}\xspace}
\newcommand{\WF}	{\textsc{Wa\-ter\-fall}\xspace}
\newcommand{\x}	{\textsc{x}\xspace}
